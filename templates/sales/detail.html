{% extends "base.html" %}
{% block title %}Sale #{{ sale.pk }} | Matyz Stock{% endblock %}
{% block page_title %}Sale #{{ sale.pk }}{% endblock %}

{% block content %}
  <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4">
    <div>
      <div class="text-sm matyz-muted">{{ sale.created_at }}</div>
      <div class="text-sm matyz-muted">
        Customer: <span class="font-semibold">{% if sale.customer %}{{ sale.customer.name }}{% else %}Walk-in{% endif %}</span>
      </div>
      {% if sale.notes %}
        <div class="mt-2 text-sm matyz-muted whitespace-pre-line">{{ sale.notes }}</div>
      {% endif %}
    </div>

    <div class="matyz-surface rounded-sm p-4 min-w-[240px]">
      <div class="text-xs matyz-muted">Total</div>
      <div class="text-2xl font-semibold">{{ sale.total }}</div>
      <div class="text-xs matyz-muted mt-1">Paid: {{ sale.paid_amount }} • Balance: {{ sale.balance }}</div>
      <div class="text-xs matyz-muted mt-1">Status: {{ sale.status }}</div>

      <div class="mt-3 flex gap-2">
        <a class="px-3 py-2 rounded-sm matyz-btn text-sm" href="{% url 'sales:edit' sale.pk %}">Edit</a>
        <a class="px-3 py-2 rounded-sm matyz-btn text-sm" href="{% url 'sales:list' %}">Back</a>
      </div>
    </div>
  </div>

  <div class="mt-6">
    <div class="text-sm font-semibold mb-2">Items</div>
    <div class="grid gap-2">
      {% for si in items %}
        <div class="matyz-surface rounded-sm p-3 flex items-center justify-between gap-3">
          <div>
            <div class="font-semibold">{{ si.item.name }}</div>
            <div class="text-xs matyz-muted">SKU: {{ si.item.sku }}</div>
          </div>
          <div class="text-right text-sm">
            <div><span class="matyz-muted">Qty:</span> {{ si.quantity }}</div>
            <div><span class="matyz-muted">Unit:</span> {{ si.unit_price }}</div>
            <div class="font-semibold">{{ si.line_total }}</div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>

  <div class="mt-6">
    <div class="text-sm font-semibold mb-2">Payments</div>

    <form method="post" action="{% url 'sales:payment_create' sale.pk %}" class="matyz-surface rounded-sm p-4 mb-3">
      {% csrf_token %}
      <div class="grid md:grid-cols-3 gap-3 items-end">
        <div>
          <label class="block text-xs matyz-muted mb-1">Amount</label>
          {{ payment_form.amount }}
        </div>
        <div>
          <label class="block text-xs matyz-muted mb-1">Method</label>
          {{ payment_form.method }}
        </div>
        <div>
          <label class="block text-xs matyz-muted mb-1">Note</label>
          {{ payment_form.note }}
        </div>
      </div>
      <button class="mt-3 px-4 py-2 rounded-sm matyz-btn text-sm" type="submit">Add payment</button>
    </form>

    <div class="grid gap-2">
      {% for p in payments %}
        <div class="matyz-surface rounded-sm p-3 flex items-center justify-between gap-3">
          <div>
            <div class="text-sm font-semibold">{{ p.amount }} • {{ p.method }}</div>
            <div class="text-xs matyz-muted">{{ p.created_at }}{% if p.note %} • {{ p.note }}{% endif %}</div>
          </div>
        </div>
      {% empty %}
        <div class="matyz-muted text-sm">No payments yet.</div>
      {% endfor %}
    </div>
  </div>

  <script>
    document.querySelectorAll("input, select, textarea").forEach(el => {
      el.classList.add("w-full","px-3","py-2","rounded-sm","matyz-surface","outline-none");
    });
  </script>
{% endblock %}
